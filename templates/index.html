{% extends 'base.html' %}
{% block title %}فرم برنامه بدنسازی{% endblock title %}

  {% block content %}
  <div class="container">
    <!-- سمت فرم -->
    <div class="form-box">
      <h2>📋 فرم برنامه اختصاصی</h2>
      <div class="progress"><div class="progress-bar"></div></div>

      <form id="fitnessForm" action="."  method="post">
        <!-- Step 1 -->
        <div class="step active">
          <label>نام و نام خانوادگی *</label>
          <input type="text" name="full_name" value="{{name}}" required>
        </div>
        <!-- Step 2 -->
        <div class="step">
          <label>سن *</label>
          <input type="number" name="age" min="10" max="85" required>
        </div>
        <!-- Step 3 -->
        <div class="step">
          <label>قد (سانتی‌متر) *</label>
          <input type="number" name="height" min="100" max="230" required>
        </div>
        <!-- Step 4 -->
        <div class="step">
          <label>وزن (کیلوگرم) *</label>
          <input type="number" name="weight" min="35" max="220" required>
        </div>
        <!-- Step 5 -->
        <div class="step">
          <label>هدف اصلی *</label>
          <select name="goal" required>
            <option value="">انتخاب کنید</option>
            <option value="کاهش زن">کاهش وزن</option>
            <option>افزایش عضله</option>
            <option>قدرت بیشتر</option>
            <option>سلامت عمومی</option>
          </select>
        </div>
        <!-- Step 6 -->
        <div class="step">
          <label>چند روز در هفته می‌تونی تمرین کنی؟ *</label>
          <select name="days" required>
            <option value="">انتخاب کنید</option>
            <option>۱ روز</option>
            <option>۲ روز</option>
            <option>۳ روز</option>
            <option>۴ روز</option>
            <option>۵ روز</option>
            <option>۶ روز</option>
            <option>۷ روز</option>
          </select>
        </div>
        <!-- Step 7 -->
        <div class="step">
          پس از زدن زوی دکمه درخواست برنامه به صفحه پرداخت منتقل می شوید پس از پرداخت پیامکی هاوی اطلاعات برنامه به شماره شما ارسال خواهد شد
        </div>

        <!-- Buttons -->
        <div class="btns">
          <button type="button" id="prevBtn">قبلی</button>
          <button type="button" id="nextBtn">بعدی</button>
        </div>
      </form>
    </div>

    <!-- سمت تصویر -->
    <div class="image-side"></div>
  </div>
  <div class="loading-box">
    <span class="loader"></span>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    let currentStep = 0;
    const steps = $(".step");
    const progressBar = $(".progress-bar");

    function showStep(n) {
      steps.removeClass("active").eq(n).addClass("active");
      progressBar.css("width", ((n+1)/steps.length*100) + "%");
      $("#prevBtn").toggle(n>0);

      $("#nextBtn").text(n===steps.length-1 ? "برنامه من رو بساز" : "بعدی");
    }

    showStep(currentStep);

    $("#nextBtn").click(function() {
      const currentInput = steps.eq(currentStep).find("input, select")[0];

      // اگر فیلد وجود داشت و نامعتبر بود
      if (currentInput && !currentInput.checkValidity()) {
        // پاک کردن خطاهای قبلی فقط برای همین فیلد
        $(currentInput).siblings(".error-text").remove();
        $(currentInput).addClass("error");

        // فقط اگر پیام خطا وجود نداره، بساز
        if ($(currentInput).siblings(".error-text").length === 0) {
          $(currentInput).after("<div class='error-text'>لطفا این قسمت را کامل کنید</div>");
        }
        return; // نذاره بره مرحله بعد
      }

      // اگر معتبر بود خطا رو پاک کنه
      $(currentInput).removeClass("error");
      $(currentInput).siblings(".error-text").remove();
      $(".loading-box").removeClass("loading-box-active")

      if(currentStep < steps.length-1){
        currentStep++;
        showStep(currentStep);
      } else {
        /*alert("🎉 اطلاعات شما ثبت شد!");
        $("#fitnessForm")[0].reset();*/
        $("#fitnessForm").submit();
        $(".loading-box").addClass("loading-box-active")
        currentStep = 0;
        showStep(currentStep);
      }
    });

    $("#prevBtn").click(function() {
      if(currentStep > 0){
        currentStep--;
        showStep(currentStep);
      }
    });


  </script>

{% endblock content %}