{% extends 'base.html' %}
{% block title %}ูุฑู ุจุฑูุงูู ุจุฏูุณุงุฒ{% endblock title %}

  {% block content %}
  <div class="container">
    <!-- ุณูุช ูุฑู -->
    <div class="form-box">
      <h2>๐ช ูุฑู ุฏุฑุงูุช ุจุฑูุงูู ู ุฑฺู</h2>

      <p class="notice">โ๏ธ ูุทูุง ุจู ุณุคุงูุงุช ุฒุฑ ุจุง ุฏูุช ูพุงุณุฎ ุฏูุฏ</p>

      <form id="fitnessForm" method="POST" novalidate>
        {{form.csrf_token}}
        <!-- STEP 1: ุงุทูุงุนุงุช ุดุฎุต -->
        <div class="step active">
          <label>ูุงู ู ูุงู ุฎุงููุงุฏฺฏ *</label>
          <input type="text" name="full_name" required data-error="ูุงู ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ">

          <label>ุดูุงุฑู ููุฑุงู *</label>
          <input type="tel" name="phone" required pattern="^\+?\d[\d\s-]{7,}$" data-error="ุดูุงุฑู ููุฑุงู ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ" placeholder="ูุซูุงู: 0912xxxxxxx">

          <label>ุงูู ุดุฎุต *</label>
          <input type="email" name="email" required data-error="ุงูู ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ" placeholder="you@example.com">
        </div>

        <!-- STEP 2: ูุฏู ู ูุดุฎุตุงุช -->
        <div class="step">
          <label>ูุฏู ุงุฒ ุฑฺู ุบุฐุง ู ุชูุฑู*</label>
          <select name="goal" required data-error="ูุฏู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ">
            <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
            <option>ฺฉุงูุด ูุฒู</option>
            <option>ุงูุฒุงุด ุนุถูู</option>
            <option>ุซุงุจุช ูฺฏู ุฏุงุดุชู ูุฒู</option>
            <option>ุงุตูุงุญ ุนุงุฏุงุช ุบุฐุง</option>
          </select>

          <label>ุณู *</label>
          <input type="number" name="age" min="10" max="100" required data-error="ุณู ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ">

          <label>ูุฏ (ุณุงูุชโูุชุฑ) *</label>
          <input type="number" name="height" min="100" max="230" required data-error="ูุฏ ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ">

          <label>ูุฒู (ฺฉููฺฏุฑู) *</label>
          <input type="number" name="weight" min="20" max="300" required data-error="ูุฒู ูุนุชุจุฑ ูุงุฑุฏ ฺฉูุฏ">
        </div>

        <!-- STEP 3: ูุถุนุช ูพุฒุดฺฉ -->
        <div class="step">
          <label>ุจูุงุฑ ุฎุงุต (ูุซูุงู: ุชุฑูุฆุฏุ ุฏุงุจุชุ ฺุฑุจ ุฎูู ู ...)</label>
          <textarea name="medical_conditions" rows="3" placeholder="ุฏุฑ ุตูุฑุช ูุฌูุฏ ุจููุณุฏ"></textarea>

          <label>ุงุณุชูุงุฏู ุงุฒ ุฏุงุฑู</label>
          <select name="medication_use">
            <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
            <option>ูุฏุงุฑุฏ</option>
            <option>ุฏุงุฑู ูุตุฑู ูโฺฉูุฏ โ ุชูุถุญ ุฏุฑ ุจุงูุง</option>
          </select>

          <label>ุญุณุงุณุช ุบุฐุง</label>
          <textarea name="food_allergies" rows="2" placeholder="ูุซูุงู: ุดุฑุ ุขุฌูุ ..."></textarea>
        </div>

        <!-- STEP 4: ูุนุงูุช ู ุจุงุดฺฏุงู -->
        <div class="step">
          <label>ุฏุฑ ุตูุฑุช ูุนุงูุช ุฏุฑ ุจุงุดฺฏุงู - ุณุงุนุช ุดุฑูุน ุชูุฑู</label>
          <input type="time" name="gym_start">

          <label>ุณุงุนุช ูพุงุงู ุชูุฑู</label>
          <input type="time" name="gym_end">

          <label>ูุฒุงู ูุนุงูุช ูุฑุฒุด</label>
          <select name="activity_level" required data-error="ูุฒุงู ูุนุงูุช ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ">
            <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
            <option>ุฎู ฺฉู (ุชูุฑุจุงู ุจุฏูู ุชูุฑู)</option>
            <option>ฺฉู (1-2 ุฌูุณู ุฏุฑ ููุชู)</option>
            <option>ูุชูุณุท (3-4 ุฌูุณู ุฏุฑ ููุชู)</option>
            <option>ุฒุงุฏ (5+ ุฌูุณู ุฏุฑ ููุชู)</option>
          </select>

          <label>ุดุบู (ุนููุงู)</label>
          <input type="text" name="job_title" max="200" placeholder="ูุซูุงู: ฺฉุงุฑููุฏุ ูุนูู">

          <label>ูุฒุงู ูุนุงูุช ฺฉุงุฑ</label>
          <select name="job_activity">
            <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
            <option>ูุดุณุชู (ุฏูุชุฑุ ุฑุงููุฏฺฏ)</option>
            <option>ูุณุจุชุงู ูุนุงู (ฺฉู ุฑุงู ุฑูุชู)</option>
            <option>ูุนุงู (ฺฉุงุฑ ูุฒฺฉ)</option>
          </select>
        </div>

        <!-- STEP 5: ุฒูุงู ุฎูุงุจ ู ูุนุฏูโูุง -->
        <div class="step">
          <label>ุณุงุนุช ุฎูุงุจ</label>
          <input required type="time" name="sleep_time">

          <label>ุณุงุนุช ุจุฏุงุฑ</label>
          <input required type="time" name="wake_time">

          <label>ุณุงุนุช ูุตุฑู ุตุจุญุงูู</label>
          <input required type="time" name="breakfast_time">

          <label>ุณุงุนุช ูุตุฑู ููุงุฑ</label>
          <input required type="time" name="lunch_time">

          <label>ุณุงุนุช ูุตุฑู ุดุงู</label>
          <input required type="time" name="dinner_time">

          <label>ุณุงุนุช ูุงูโูุนุฏู ุตุจุญ</label>
          <input type="time" name="snack_morning_time">

          <label>ุณุงุนุช ูุงูโูุนุฏู ุนุตุฑ</label>
          <input type="time" name="snack_evening_time">
        </div>

        <!-- STEP 6: ุณูุงุจู ุฑฺู / ูฺฉูู -->
        <div class="step">
          <label>ุชุง ุญุงูุง ุฑฺู ฺฏุฑูุชูโุงุฏุ</label>
          <select name="previous_diet" required>
            <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
            <option>ุจูู</option>
            <option>ุฎุฑ</option>
          </select>

          <label>ูฺฉูู ูุตุฑู ฺฉุฑุฏูโุงุฏุ</label>
          <select name="supplement_used" required>
            <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
            <option>ุจูู</option>
            <option>ุฎุฑ</option>
          </select>

          <label>ุชูุงู ุจู ูุตุฑู ูฺฉูู ุฏุงุฑุฏุ</label>
          <select name="willing_supplement" required>
            <option value="">ุงูุชุฎุงุจ ฺฉูุฏ</option>
            <option>ุจูู</option>
            <option>ุฎุฑ</option>
            <option>ุจุง ูุดูุฑุช ูุฑุจ/ูุชุฎุตุต</option>
          </select>
        </div>

        <!-- STEP 7: ุนุงุฏุงุช ุบุฐุง (ุตุจุญุงููุ ูุงูุงุฑุ ุดุงูุ ูุงูโูุนุฏูโูุง) -->
        <div class="step">
          <label>ูุนูููุงู ุจุฑุง ุตุจุญุงูู ฺู ฺุฒูุง ูู ูโฺฉูุฏ ู ฺูุฏุฑ</label>
          <textarea name="breakfast_items" rows="3" required placeholder="ูุซูุงู: ูพูุฑ ู ูุงู (ฒ ุจุฑุด) ู ฺุง"></textarea>

          <label>ูุนูููุงู ุจุฑุง ูุงูุงุฑ ฺู ฺุฒูุง ูู ูโฺฉูุฏ ู ฺูุฏุฑ</label>
          <textarea name="lunch_items" rows="3" required></textarea>

          <label>ูุนูููุงู ุจุฑุง ุดุงู ฺู ฺุฒูุง ูู ูโฺฉูุฏ ู ฺูุฏุฑ</label>
          <textarea name="dinner_items" rows="3" required></textarea>

          <label>ฺู ฺุฒูุง ุจุฑุง ูุงูโูุนุฏูโูุง ุงุณุชูุงุฏู ูโฺฉูุฏ ู ฺูุฏุฑ</label>
          <textarea name="snack_items" rows="3" required></textarea>
        </div>

        <!-- Buttons -->
        <div class="btns">
          <button type="button" class="btn-primary" id="prevBtn">ยซ ูุจู</button>
          <button type="button" class="btn-primary" id="nextBtn">ุจุนุฏ ยป</button>
        </div>
      </form>
    </div>

    <!-- ุณูุช ุชุตูุฑ -->
    <div class="image-side"></div>
  </div>
  <div class="loading-box">
    <span class="loader"></span>
  </div>
  
  <script>
    let currentStep = 0;
    const steps = $(".step");
    const progressBar = $(".progress-bar");

    function showStep(n) {
      steps.removeClass("active").eq(n).addClass("active");
      progressBar.css("width", ((n+1)/steps.length*100) + "%");
      $("#prevBtn").toggle(n>0);

      $("#nextBtn").text(n===steps.length-1 ? "ุจุฑูุงูู ูู ุฑู ุจุณุงุฒ" : "ุจุนุฏ");
    }

    showStep(currentStep);

    $("#nextBtn").click(function() {
      const currentInput = steps.eq(currentStep).find("input, select")[0];

      // ุงฺฏุฑ ููุฏ ูุฌูุฏ ุฏุงุดุช ู ูุงูุนุชุจุฑ ุจูุฏ
      if (currentInput && !currentInput.checkValidity()) {
        // ูพุงฺฉ ฺฉุฑุฏู ุฎุทุงูุง ูุจู ููุท ุจุฑุง ููู ููุฏ
        $(currentInput).siblings(".error-text").remove();
        $(currentInput).addClass("error");

        // ููุท ุงฺฏุฑ ูพุงู ุฎุทุง ูุฌูุฏ ูุฏุงุฑูุ ุจุณุงุฒ
        if ($(currentInput).siblings(".error-text").length === 0) {
          $(currentInput).after("<div class='error-text'>ูุทูุง ุงู ูุณูุช ุฑุง ฺฉุงูู ฺฉูุฏ</div>");
        }
        return; // ูุฐุงุฑู ุจุฑู ูุฑุญูู ุจุนุฏ
      }

      // ุงฺฏุฑ ูุนุชุจุฑ ุจูุฏ ุฎุทุง ุฑู ูพุงฺฉ ฺฉูู
      $(currentInput).removeClass("error");
      $(currentInput).siblings(".error-text").remove();
      $(".loading-box").removeClass("loading-box-active")

      if(currentStep < steps.length-1){
        currentStep++;
        showStep(currentStep);
      } else {
        /*alert("๐ ุงุทูุงุนุงุช ุดูุง ุซุจุช ุดุฏ!");
        $("#fitnessForm")[0].reset();*/
        $("#fitnessForm").submit();
        $(".loading-box").addClass("loading-box-active")
        currentStep = 0;
        showStep(currentStep);
      }
    });

    $("#prevBtn").click(function() {
      if(currentStep > 0){
        currentStep--;
        showStep(currentStep);
      }
    });


  </script>

{% endblock content %}